"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.select = void 0;
const queryConnector_1 = require("../../queryConnector");
require("dotenv/config");
const select = async (chosenOption, values) => {
    if (!values) {
        values = "";
    }
    const codes = {
        0: `SELECT REVISAO, NUMERO_ODF, NUMERO_OPERACAO, CODIGO_MAQUINA, QTDE_ODF, QTDE_APONTADA, QTDE_LIB, CODIGO_PECA, QTD_BOAS, QTD_REFUGO, QTD_FALTANTE, QTD_RETRABALHADA, CODIGO_CLIENTE, QTD_ESTORNADA FROM ${process.env['viewOdfsGathered']} (NOLOCK) WHERE 1 = 1 AND NUMERO_ODF = ${values.NUMERO_ODF} AND CODIGO_PECA IS NOT NULL ORDER BY NUMERO_OPERACAO ASC`,
        1: `SELECT DESCRICAO FROM CST_MOTIVO_REFUGO (NOLOCK) ORDER BY DESCRICAO ASC`,
        2: `SELECT DISTINCT [NUMPEC], [IMAGEM] FROM QA_LAYOUT (NOLOCK) WHERE 1 = 1 AND NUMPEC = '${values.CODIGO_PECA}' AND REVISAO = ${values.REVISAO} AND IMAGEM IS NOT NULL`,
        3: `SELECT TOP 1 NUMPEC, QUANT, REVISAO, COMPRIMENTO, LARGURA, AREA, EXECUT FROM OPERACAO WHERE 1 = 1 AND NUMPEC = '${values.CODIGO_PECA}' AND REVISAO = ${values.REVISAO} AND NUMITE IS NOT NULL`,
        4: `SELECT * FROM CST_CAD_ENDERECOS CE WHERE 1 = 1 AND ENDERECO = '${values.ENDERECO}'`,
        5: `SELECT * FROM VW_APP_APONTAMENTO_HISTORICO_DETALHADO WHERE 1 = 1 AND ODF = '${values.NUMERO_ODF}' ORDER BY DATAHORA DESC`,
        6: `SELECT * FROM VW_APP_APONTAMENTO_HISTORICO WHERE 1 = 1 AND ODF = '${values.NUMERO_ODF}' ORDER BY OP ASC`,
        7: `SELECT CODIGO_CLIENTE, REVISAO, NUMERO_ODF, NUMERO_OPERACAO, CODIGO_MAQUINA, QTDE_ODF, QTDE_APONTADA, QTDE_LIB, QTD_REFUGO, CODIGO_PECA, HORA_FIM, HORA_INICIO, DT_INICIO_OP, DT_FIM_OP, QTD_BOAS FROM ${process.env['viewOdfsGathered']} (NOLOCK) WHERE 1 = 1 AND NUMERO_ODF = ${values.NUMERO_ODF} AND CODIGO_PECA IS NOT NULL ORDER BY NUMERO_OPERACAO ASC`,
        10: `SELECT TOP 1 CRACHA FROM VIEW_GRUPO_APT WHERE 1 = 1 AND CRACHA  = '${values.supervisor}'`,
        13: `SELECT DESCRICAO FROM MOTIVO_DEVOLUCAO`,
        14: `SELECT DISTINCT PROCESSO.NUMPEC, PROCESSO.REVISAO, QA_CARACTERISTICA.NUMCAR AS NUMCAR, QA_CARACTERISTICA.CST_NUMOPE AS CST_NUMOPE, QA_CARACTERISTICA.DESCRICAO, ESPECIFICACAO  AS ESPECIF, LIE, LSE, QA_CARACTERISTICA.INSTRUMENTO FROM PROCESSO INNER JOIN CLIENTES ON PROCESSO.RESUCLI = CLIENTES.CODIGO INNER JOIN QA_CARACTERISTICA ON QA_CARACTERISTICA.NUMPEC=PROCESSO.NUMPEC AND QA_CARACTERISTICA.REV_QA=PROCESSO.REV_QA  AND QA_CARACTERISTICA.REVISAO = PROCESSO.REVISAO  LEFT JOIN (SELECT OP.MAQUIN, OP.NUMPEC, OP.RECNO_PROCESSO, LTRIM(NUMOPE) AS CST_SEQUENCIA FROM OPERACAO OP (NOLOCK)) AS TBL ON TBL.RECNO_PROCESSO = PROCESSO.R_E_C_N_O_  AND TBL.MAQUIN = QA_CARACTERISTICA.CST_NUMOPE WHERE PROCESSO.NUMPEC = '${values.CODIGO_PECA}'  AND PROCESSO.REVISAO = '${values.REVISAO}'  AND CST_NUMOPE = '${values.CODIGO_MAQUINA}' AND NUMCAR < '2999' ORDER BY NUMPEC ASC`,
        16: `SELECT TOP 1 [FUNCIONARIO], [CRACHA] FROM FUNCIONARIOS WHERE 1 = 1 AND [CRACHA] = '${values.badge}' ORDER BY FUNCIONARIO`,
        20: `SELECT [CODIGO], [IMAGEM] FROM VIEW_APTO_FERRAMENTAL WHERE 1 = 1 AND IMAGEM IS NOT NULL AND CODIGO = '${values.CODIGO_PECA}' AND MAQUINA = '${values.CODIGO_MAQUINA}' AND NUMOPE = ${values.NUMERO_OPERACAO}`,
        21: `SELECT QUANTIDADE FROM ALOCACAO_POINT WHERE 1 = 1 AND ODF = ${values.NUMERO_ODF} ORDER BY CODIGO ASC`,
        22: `SELECT DISTINCT PCP.NUMERO_ODF, OP.NUMITE, OP.NUMSEQ, CAST(LTRIM(OP.NUMOPE) AS INT) AS NUMOPE, CAST(OP.EXECUT AS INT) AS EXECUT, CONDIC, CAST(E.SALDOREAL AS INT) AS SALDOREAL, CAST(((E.SALDOREAL - ISNULL((SELECT ISNULL(SUM(QUANTIDADE),0) FROM ALOCACAO_POINT CA (NOLOCK) WHERE CA.CODIGO_FILHO = E.CODIGO AND CA.ODF = PCP.NUMERO_ODF),0)) / ISNULL(OP.EXECUT,0)) AS INT) AS QTD_LIBERADA_PRODUZIR, ISNULL((SELECT ISNULL(SUM(QUANTIDADE),0) FROM ALOCACAO_POINT CA (NOLOCK) WHERE CA.CODIGO_FILHO = E.CODIGO),0) as RESERVADO FROM PROCESSO PRO (NOLOCK) INNER JOIN OPERACAO OP (NOLOCK) ON OP.RECNO_PROCESSO = PRO.R_E_C_N_O_ INNER JOIN ESTOQUE E (NOLOCK) ON E.CODIGO = OP.NUMITE INNER JOIN PCP_PROGRAMACAO_PRODUCAO PCP (NOLOCK) ON PCP.CODIGO_PECA = OP.NUMPEC WHERE 1 = 1 AND PRO.ATIVO ='S' AND PRO.CONCLUIDO ='T' AND OP.CONDIC ='P' AND PCP.NUMERO_ODF = '${values.NUMERO_ODF}' AND OP.NUMSEQ = ${Number(values.NUMERO_OPERACAO)}`,
        23: `SELECT TOP 1 NUMOPE, CODAPONTA, USUARIO, CAMPO1, DATAHORA FROM HISAPONTA WHERE 1 = 1 AND ODF = '${values.NUMERO_ODF}' ORDER BY R_E_C_N_O_ DESC`,
        27: `SELECT  DESCRICAO FROM APT_PARADA (NOLOCK) ORDER BY DESCRICAO ASC`,
        29: `SELECT TOP 1 SALDO FROM HISREAL WHERE 1 = 1 AND CODIGO = '${values.partCode}' ORDER BY DATA DESC`,
        30: `SELECT TOP 1 QTDE_LIB FROM ${process.env['viewOdfsGathered']} WHERE 1 = 1 AND NUMERO_ODF = '${values.NUMERO_ODF}' AND CODIGO_MAQUINA = '${values.CODIGO_MAQUINA}' AND NUMERO_OPERACAO = ${values.NUMERO_OPERACAO}`,
        31: `SELECT * FROM HISTORICO_ENDERECO WHERE 1 = 1 AND ODF = '${values.NUMERO_ODF}' AND NUMERO_OPERACAO = ${Number(values.NUMERO_OPERACAO)} ORDER BY DATAHORA DESC`,
        32: `SELECT TOP 1 DATA_FIM_CONVERTIDA, NUMOPE, CODIGO_MAQUINA, NUMERO_ODF, DT_FIM_OP, * FROM VW_APP_SEQUENCIAMENTO_MAQUINA AS SM ORDER BY SM.DATA_FIM_CONVERTIDA ASC`,
        37: `IF NOT EXISTS(
                            SELECT TOP 1
                                *
                            FROM
                                VIEW_APTO_ESTOQUE_ENDERECO
                            WHERE 1 = 1
                                AND COMPRIMENTO > ${values.maxSize}
                                AND LARGURA > ${values.maxWidth}
                                AND PESO > ${values.maxWeight}
                                AND COD_PRODUTO = '${values.CODIGO_PECA}' AND ENDERECO LIKE '${values.percen}%')
                        BEGIN
                            SELECT TOP 1 
                                *
                            FROM 
                                VIEW_APTO_ESTOQUE_ENDERECO
                            WHERE 1 = 1
                                AND COMPRIMENTO > ${values.maxSize}
                                AND LARGURA > ${values.maxWidth}
                                AND PESO > ${values.maxWeight}
                                AND COD_PRODUTO IS NULL AND ENDERECO LIKE '${values.percen}%'
                        END
                ELSE
                    BEGIN
                        SELECT TOP 1 
                            *
                        FROM 
                            VIEW_APTO_ESTOQUE_ENDERECO
                        WHERE 1 = 1
                                AND COMPRIMENTO > ${values.maxSize}
                                AND LARGURA > ${values.maxWidth}
                                AND PESO > ${values.maxWeight}
                                AND COD_PRODUTO = '${values.CODIGO_PECA}' AND ENDERECO LIKE '${values.percen}%'
                    END`,
        39: `	IF OBJECT_ID('MOTIVO_DEVOLUCAO') IS NULL
        BEGIN
            CREATE TABLE MOTIVO_DEVOLUCAO(
                    R_E_C_N_O INT IDENTITY NOT NULL PRIMARY KEY,
                    DESCRICAO VARCHAR(100),
                )
            INSERT INTO MOTIVO_DEVOLUCAO (DESCRICAO) VALUES ('ERRO DE APONTAMENTO')
        END

                ALTER VIEW VW_APP_APONTAMENTO_HISTORICO_DETALHADO           
                AS          
                SELECT         
                DATAHORA,
                CAMPO1,
                LTRIM(NUMOPE) AS 'OP',CAST(ITEM AS VARCHAR(6)) AS 'MAQUINA',            
                CAST(SUM(PC_BOAS) AS DECIMAL(5,0)) AS 'BOAS',     
                CAST(SUM(PC_REFUGA) AS DECIMAL(5, 0)) AS 'REFUGO',  
                CAST(SUM(CST_QTD_RETRABALHADA) AS DECIMAL(5,0)) AS 'RETRABALHADAS',    
            -- CAST(SUM(CASE WHEN PC_REFUGA > 0 THEN 0 ELSE PC_REFUGA END) AS DECIMAL(5,0)) AS 'REFUGO',             
                CAST(SUM(CST_PC_FALTANTE) AS DECIMAL(5,0)) AS 'PC_FALTANTE',            
                ODF
                FROM HISAPONTA (NOLOCK)             
                WHERE CODAPONTA NOT IN(1,2,3,5,6,7)      
                GROUP BY ODF,ITEM,NUMOPE,DATAHORA,CAMPO1  


                ALTER VIEW VW_APP_APONTAMENTO_HISTORICO         
                AS            
                SELECT
                CAMPO1,
                LTRIM(NUMOPE) AS 'OP',CAST(ITEM AS VARCHAR(6)) AS 'MAQUINA',          
                CAST(SUM(PC_BOAS) AS DECIMAL(5,0)) AS 'BOAS',  
                CAST(SUM(PC_REFUGA) AS DECIMAL(5, 0)) AS 'REFUGO',  
                CAST(SUM(CST_QTD_RETRABALHADA) AS DECIMAL(5,0)) AS 'RETRABALHADAS',          
            -- CAST(SUM(CASE WHEN PC_REFUGA > 0 THEN 0 ELSE PC_REFUGA END) AS DECIMAL(5,0)) AS 'REFUGO',           
                CAST(SUM(CST_PC_FALTANTE) AS DECIMAL(5,0)) AS 'PC_FALTANTE',          
                ODF      
                FROM HISAPONTA (NOLOCK)           
                WHERE CODAPONTA NOT IN(1,2,3,5,6,7)    
                GROUP BY ODF,ITEM,NUMOPE,CAMPO1


        IF OBJECT_ID('HISTORICO_ENDERECO') IS NULL
            BEGIN
                CREATE TABLE HISTORICO_ENDERECO (
                    R_E_C_N_O INT IDENTITY NOT NULL PRIMARY KEY,
                    DATAHORA DATETIME,
                    ODF VARCHAR(50),
                    CODIGO_PECA VARCHAR(50),
                    CODIGO_FILHO VARCHAR(50),
                    QUANTIDADE DECIMAL(19,2),
                    ENDERECO_ATUAL VARCHAR(50),
                    ENDERECO_SAIDA VARCHAR(50),
                    ENDERECO_FUTURO VARCHAR(50),
                    STATUS VARCHAR(30),
                    NUMERO_OPERACAO VARCHAR(20),
                )
            END

					IF OBJECT_ID('NOVA_ORDEM') IS NULL
						BEGIN
							CREATE TABLE NOVA_ORDEM (
								R_E_C_N_0 INT IDENTITY NOT NULL,
								NUMERO_ODF VARCHAR(21), 
								NUMERO_OPERACAO VARCHAR(5), 
								CODIGO_MAQUINA  VARCHAR(50),
								REVISAO VARCHAR(5),
								QTDE_ODF  DECIMAL(19,2), 
								QTDE_LIB  DECIMAL(19,2), 
								QTDE_APONTADA  DECIMAL(19,2),
								QTD_REFUGO  DECIMAL(19,2), 
								QTD_BOAS DECIMAL(19,2), 
								QTD_RETRABALHADA   DECIMAL(19,2), 
								QTD_FALTANTE DECIMAL(19,2),
								CODIGO_PECA VARCHAR(50),
								USUARIO VARCHAR(100),
								CODIGO_CLIENTE VARCHAR(50),
							)
						END`,
        42: `SELECT TOP 1 * FROM VW_FEED_ODF WHERE 1 = 1 AND NUMPEC = '${values.CODIGO_PECA}' AND IMAGEM IS NOT NULL AND NUMERO_ODF = '${values.NUMERO_ODF}' AND NUMERO_OPERACAO = ${Number(values.NUMERO_OPERACAO)} AND CODIGO_MAQUINA = '${values.CODIGO_MAQUINA}' AND CODIGO_PECA = '${values.CODIGO_PECA}' AND REVISAO = '${values.REVISAO}'`,
        "userAvailable": `SELECT EMPLOYEE_MOD, ENDERECO_MOD, RIP_MOD, DESENHO_TECNICO_MOD, FERRAMENTA_MOD, SUPERVISOR_MOD, MOTIVOS_MOD, EMAIL_MOD, ESTOQUE_MOD, HISTORICO_MOD FROM USER_MODULES WHERE 1 = 1 AND COMPANY_ID = ${values.COMPANY_ID}`,
        "viewOdfsGathered": `SELECT TOP 1 REVISAO, NUMERO_ODF, NUMERO_OPERACAO, CODIGO_MAQUINA, QTDE_ODF, QTDE_APONTADA, QTDE_LIB, CODIGO_PECA, QTD_BOAS, QTD_REFUGO, QTD_FALTANTE, QTD_RETRABALHADA, CODIGO_CLIENTE FROM ${process.env['viewOdfsGathered']} (NOLOCK) WHERE 1 = 1 AND NUMERO_ODF = ${values.NUMERO_ODF} AND NUMERO_OPERACAO = ${values.NUMERO_OPERACAO} AND CODIGO_PECA IS NOT NULL ORDER BY NUMERO_OPERACAO ASC`,
        "codAponta": `SELECT TOP 1 NUMOPE, CODAPONTA, USUARIO, CAMPO1, DATAHORA FROM HISAPONTA WHERE 1 = 1 AND ODF = '${values.NUMERO_ODF}' ORDER BY R_E_C_N_O_ DESC`,
        "PCPTOP1": `SELECT TOP 1 REVISAO, NUMERO_ODF, NUMERO_OPERACAO, CODIGO_MAQUINA, QTDE_ODF, QTDE_APONTADA, QTDE_LIB, CODIGO_PECA, QTD_BOAS, QTD_REFUGO, QTD_FALTANTE, QTD_RETRABALHADA, CODIGO_CLIENTE, QTD_ESTORNADA FROM ${process.env['viewOdfsGathered']} (NOLOCK) WHERE 1 = 1 AND NUMERO_ODF = ${values.NUMERO_ODF} AND NUMERO_OPERACAO = ${values.NUMERO_OPERACAO} AND CODIGO_PECA IS NOT NULL ORDER BY NUMERO_OPERACAO ASC`,
        "OperacaoSemRevisao": `SELECT TOP 1 NUMPEC, QUANT, REVISAO, COMPRIMENTO, LARGURA, AREA, EXECUT FROM OPERACAO WHERE 1 = 1 AND NUMPEC = '${values.CODIGO_PECA}'`,
        "SelectAllOdfs": `SELECT TOP 50 CODIGO_PECA, NUMERO_ODF, CODIGO_MAQUINA, QTDE_ODF, NUMERO_OPERACAO, CODIGO_CLIENTE FROM PCP_PROGRAMACAO_PRODUCAO WHERE 1 = 1 ORDER BY NUMERO_ODF DESC, NUMERO_OPERACAO ASC`,
        "SearchOdf": `SELECT TOP 15 CODIGO_PECA, NUMERO_ODF, CODIGO_MAQUINA, QTDE_ODF, NUMERO_OPERACAO, CODIGO_CLIENTE FROM PCP_PROGRAMACAO_PRODUCAO WHERE 1 = 1 AND NUMERO_ODF LIKE '${values.barcode}%' ORDER BY NUMERO_ODF ASC, NUMERO_OPERACAO ASC`,
        "HISTORICO_ESTOQUE_POINT": `
                               IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'HISTORICO_ESTOQUE_POINT')
                                    BEGIN
                                        CREATE TABLE HISTORICO_ESTOQUE_POINT (
                                            ID INT IDENTITY,
                                            DATAHORA DATETIME,
                                            STATUS VARCHAR(7),
                                            ODF VARCHAR(200), 
                                            CODIGO_PECA VARCHAR(200),
                                            QUANTIDADE INT,
                                            USUARIO VARCHAR(200)
                                        )
                                    END 
                SELECT DATAHORA, STATUS, ODF, CODIGO_PECA, QUANTIDADE, USUARIO FROM HISTORICO_ESTOQUE_POINT WHERE 1 = 1 AND ODF = '${values.NUMERO_ODF}' ORDER BY DATAHORA DESC
                `,
        "deleteOdfQuery": `DELETE PCP_PROGRAMACAO_PRODUCAO WHERE 1 = 1 AND NUMERO_ODF = '${values.NUMERO_ODF}'`,
    };
    try {
        const conn = await (0, queryConnector_1.poolConnection)();
        const data = await conn.request().query(`${codes[String(chosenOption)]}`).then((result) => result.recordset);
        return !data || data.length <= 0 ? '' : data;
    }
    catch (error) {
        console.log('Error on Select -', error);
        return '';
    }
};
exports.select = select;
//# sourceMappingURL=query.js.map